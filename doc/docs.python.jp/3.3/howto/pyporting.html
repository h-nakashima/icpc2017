<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Python 2 から Python 3 への移植 &mdash; Python 3.3.6 ドキュメント</title>
    
    <link rel="stylesheet" href="../_static/pydoctheme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.3.6',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Python 3.3.6 ドキュメント 内を検索"
          href="../_static/opensearch.xml"/>
    <link rel="author" title="このドキュメントについて" href="../about.html" />
    <link rel="copyright" title="著作権" href="../copyright.html" />
    <link rel="top" title="Python 3.3.6 ドキュメント" href="../contents.html" />
    <link rel="up" title="Python HOWTO" href="index.html" />
    <link rel="next" title="Python 3 への拡張モジュール移植" href="cporting.html" />
    <link rel="prev" title="Python HOWTO" href="index.html" />
    <link rel="shortcut icon" type="image/png" href="../_static/py.png" />
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <script type="text/javascript" src="../_static/_jp.js"></script>
    <script type="text/javascript" src="../_static/version_switch.js"></script>
    
 

  <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-34175846-1', 'python.jp');
        ga('send', 'pageview');

      </script>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総合索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="cporting.html" title="Python 3 への拡張モジュール移植"
             accesskey="N">次へ</a> |</li>
        <li class="right" >
          <a href="index.html" title="Python HOWTO"
             accesskey="P">前へ</a> |</li>
        <li><img src="../_static/py.png" alt=""
                 style="vertical-align: middle; margin-top: -1px"/></li>
        <li><a href="http://www.python.org/">Python</a> &raquo;</li>
        <li>
          <span class="version_switcher_placeholder">3.3.6</span>
          <a href="../index.html">Documentation</a> &raquo;
        </li>

          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Python HOWTO</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="porting-python-2-code-to-python-3">
<span id="pyporting-howto"></span><h1>Python 2 から Python 3 への移植<a class="headerlink" href="#porting-python-2-code-to-python-3" title="このヘッドラインへのパーマリンク">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">author:</th><td class="field-body">Brett Cannon</td>
</tr>
</tbody>
</table>
<div class="topic">
<p class="topic-title first">概要</p>
<p>With Python 3 being the future of Python while Python 2 is still in active
use, it is good to have your project available for both major releases of
Python. This guide is meant to help you figure out how best to support both
Python 2 &amp; 3 simultaneously.</p>
<p>もしあなたが標準 Python ライブラリではなく拡張ライブラリでの移植手段を探しているならば <a class="reference internal" href="cporting.html#cporting-howto"><span>Python 3 への拡張モジュール移植</span></a> を参照してください。</p>
<p>If you would like to read one core Python developer&#8217;s take on why Python 3
came into existence, you can read Nick Coghlan&#8217;s <a class="reference external" href="http://ncoghlan-devs-python-notes.readthedocs.org/en/latest/python3/questions_and_answers.html">Python 3 Q &amp; A</a>.</p>
<p>If you prefer to read a (free) book on porting a project to Python 3,
consider reading <a class="reference external" href="http://python3porting.com/">Porting to Python 3</a> by Lennart Regebro which should cover
much of what is discussed in this HOWTO.</p>
<p>For help with porting, you can email the <a class="reference external" href="http://mail.python.org/mailman/listinfo/python-porting">python-porting</a> mailing list with
questions.</p>
</div>
<div class="section" id="the-short-version">
<h2>The Short Version<a class="headerlink" href="#the-short-version" title="このヘッドラインへのパーマリンク">¶</a></h2>
<ul class="simple">
<li>Decide what&#8217;s the oldest version of Python 2 you want to support (if at all)</li>
<li>Make sure you have a thorough test suite and use continuous integration
testing to make sure you stay compatible with the versions of Python you care
about</li>
<li>If you have dependencies, check their Python 3 status using caniusepython3
(<a class="reference external" href="https://pypi.python.org/pypi/caniusepython3">command-line tool</a>,
<a class="reference external" href="https://caniusepython3.com/">web app</a>)</li>
</ul>
<p>With that done, your options are:</p>
<ul class="simple">
<li>If you are dropping Python 2 support, use <a class="reference external" href="http://docs.python.org/2/library/2to3.html">2to3</a> to port to Python 3</li>
<li>If you are keeping Python 2 support, then start writing Python 2/3-compatible
code starting <strong>TODAY</strong><ul>
<li>If you have dependencies that have not been ported, reach out to them to port
their project while working to make your code compatible with Python 3 so
you&#8217;re ready when your dependencies are all ported</li>
<li>If all your dependencies have been ported (or you have none), go ahead and
port to Python 3</li>
</ul>
</li>
<li>If you are creating a new project that wants to have 2/3 compatibility,
code in Python 3 and then backport to Python 2</li>
</ul>
</div>
<div class="section" id="before-you-begin">
<h2>Before You Begin<a class="headerlink" href="#before-you-begin" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>If your project is on the <a class="reference external" href="http://pypi.python.org/">Cheeseshop</a>/<a class="reference external" href="http://pypi.python.org/">PyPI</a>, make sure it has the proper
<a class="reference external" href="https://pypi.python.org/pypi?%3Aaction=list_classifiers">trove classifiers</a> to signify what versions of Python it <strong>currently</strong>
supports. At minimum you should specify the major version(s), e.g.
<code class="docutils literal"><span class="pre">Programming</span> <span class="pre">Language</span> <span class="pre">::</span> <span class="pre">Python</span> <span class="pre">::</span> <span class="pre">2</span></code> if your project currently only supports
Python 2. It is preferrable that you be as specific as possible by listing every
major/minor version of Python that you support, e.g. if your project supports
Python 2.6 and 2.7, then you want the classifiers of:</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="n">Programming</span> <span class="n">Language</span> <span class="p">::</span> <span class="n">Python</span> <span class="p">::</span> <span class="mi">2</span>
<span class="n">Programming</span> <span class="n">Language</span> <span class="p">::</span> <span class="n">Python</span> <span class="p">::</span> <span class="mf">2.6</span>
<span class="n">Programming</span> <span class="n">Language</span> <span class="p">::</span> <span class="n">Python</span> <span class="p">::</span> <span class="mf">2.7</span>
</pre></div>
</div>
<p>Once your project supports Python 3 you will want to go back and add the
appropriate classifiers for Python 3 as well. This is important as setting the
<code class="docutils literal"><span class="pre">Programming</span> <span class="pre">Language</span> <span class="pre">::</span> <span class="pre">Python</span> <span class="pre">::</span> <span class="pre">3</span></code> classifier will lead to your project
being listed under the <a class="reference external" href="https://pypi.python.org/pypi?:action=browse&amp;c=533&amp;show=all">Python 3 Packages</a> section of PyPI.</p>
<p>Make sure you have a robust test suite. You need to
make sure everything continues to work, just like when you support a new
minor/feature release of Python. This means making sure your test suite is
thorough and is ported properly between Python 2 &amp; 3 (consider using <a class="reference external" href="https://pypi.python.org/pypi/coverage">coverage</a>
to measure that you have effective test coverage). You will also most likely
want to use something like <a class="reference external" href="https://pypi.python.org/pypi/tox">tox</a> to automate testing between all of your
supported versions of Python. You will also want to <strong>port your tests first</strong> so
that you can make sure that you detect breakage during the transition. Tests also
tend to be simpler than the code they are testing so it gives you an idea of how
easy it can be to port code.</p>
<p>Drop support for older Python versions if possible. <a class="reference external" href="http://www.python.org/2.5.x">Python 2.5</a>
introduced a lot of useful syntax and libraries which have become idiomatic
in Python 3. <a class="reference external" href="http://www.python.org/2.6.x">Python 2.6</a> introduced future statements which makes
compatibility much easier if you are going from Python 2 to 3.
<a class="reference external" href="http://www.python.org/2.7.x">Python 2.7</a> continues the trend in the stdlib. Choose the newest version
of Python which you believe can be your minimum support version
and work from there.</p>
<p>Target the newest version of Python 3 that you can. Beyond just the usual
bugfixes, compatibility has continued to improve between Python 2 and 3 as time
has passed. E.g. Python 3.3 added back the <code class="docutils literal"><span class="pre">u</span></code> prefix for
strings, making source-compatible Python code easier to write.</p>
</div>
<div class="section" id="writing-source-compatible-python-2-3-code">
<h2>Writing Source-Compatible Python 2/3 Code<a class="headerlink" href="#writing-source-compatible-python-2-3-code" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Over the years the Python community has discovered that the easiest way to
support both Python 2 and 3 in parallel is to write Python code that works in
either version. While this might sound counter-intuitive at first, it actually
is not difficult and typically only requires following some select
(non-idiomatic) practices and using some key projects to help make bridging
between Python 2 and 3 easier.</p>
<div class="section" id="projects-to-consider">
<h3>Projects to Consider<a class="headerlink" href="#projects-to-consider" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>The lowest level library for supporting Python 2 &amp; 3 simultaneously is <a class="reference external" href="http://packages.python.org/six">six</a>.
Reading through its documentation will give you an idea of where exactly the
Python language changed between versions 2 &amp; 3 and thus what you will want the
library to help you continue to support.</p>
<p>To help automate porting your code over to using six, you can use
<a class="reference external" href="https://github.com/mitsuhiko/python-modernize">modernize</a>. This project will attempt to rewrite your code to be as modern as
possible while using six to smooth out any differences between Python 2 &amp; 3.</p>
<p>If you want to write your compatible code to feel more like Python 3 there is
the <a class="reference external" href="http://python-future.org/">future</a> project. It tries to provide backports of objects from Python 3 so
that you can use them from Python 2-compatible code, e.g. replacing the
<code class="docutils literal"><span class="pre">bytes</span></code> type from Python 2 with the one from Python 3.
It also provides a translation script like modernize (its translation code is
actually partially based on it) to help start working with a pre-existing code
base. It is also unique in that its translation script will also port Python 3
code backwards as well as Python 2 code forwards.</p>
</div>
<div class="section" id="tips-tricks">
<h3>Tips &amp; Tricks<a class="headerlink" href="#tips-tricks" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>To help with writing source-compatible code using one of the projects mentioned
in <a class="reference internal" href="#projects-to-consider">Projects to Consider</a>, consider following the below suggestions. Some of
them are handled by the suggested projects, so if you do use one of them then
read their documentation first to see which suggestions below will taken care of
for you.</p>
<div class="section" id="support-python-2-7">
<h4>Python 2.7 のサポート<a class="headerlink" href="#support-python-2-7" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>As a first step, make sure that your project is compatible with <a class="reference external" href="http://www.python.org/2.7.x">Python 2.7</a>.
This is just good to do as Python 2.7 is the last release of Python 2 and thus
will be used for a rather long time. It also allows for use of the <code class="docutils literal"><span class="pre">-3</span></code> flag
to Python to help discover places in your code where compatibility might be an
issue (the <code class="docutils literal"><span class="pre">-3</span></code> flag is in Python 2.6 but Python 2.7 adds more warnings).</p>
</div>
<div class="section" id="try-to-support-python-2-6-and-newer-only">
<h4><a class="reference external" href="http://www.python.org/2.6.x">Python 2.6</a> 以降のバージョンのサポート<a class="headerlink" href="#try-to-support-python-2-6-and-newer-only" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>While not possible for all projects, if you can support <a class="reference external" href="http://www.python.org/2.6.x">Python 2.6</a> and newer
<strong>only</strong>, your life will be much easier. Various future statements, stdlib
additions, etc. exist only in Python 2.6 and later which greatly assist in
supporting Python 3. But if you project must keep support for <a class="reference external" href="http://www.python.org/2.5.x">Python 2.5</a> then
it is still possible to simultaneously support Python 3.</p>
<p>Below are the benefits you gain if you only have to support Python 2.6 and
newer. Some of these options are personal choice while others are
<strong>strongly</strong> recommended (the ones that are more for personal choice are
labeled as such).  If you continue to support older versions of Python then you
at least need to watch out for situations that these solutions fix and handle
them appropriately (which is where library help from e.g. <a class="reference external" href="http://packages.python.org/six">six</a> comes in handy).</p>
<div class="section" id="from-future-import-print-function">
<h5><code class="docutils literal"><span class="pre">from</span> <span class="pre">__future__</span> <span class="pre">import</span> <span class="pre">print_function</span></code><a class="headerlink" href="#from-future-import-print-function" title="このヘッドラインへのパーマリンク">¶</a></h5>
<p>It will not only get you used to typing <code class="docutils literal"><span class="pre">print()</span></code> as a function instead of a
statement, but it will also give you the various benefits the function has over
the Python 2 statement (<a class="reference external" href="http://packages.python.org/six">six</a> provides a function if you support Python 2.5 or
older).</p>
</div>
<div class="section" id="from-future-import-unicode-literals">
<h5><code class="docutils literal"><span class="pre">from</span> <span class="pre">__future__</span> <span class="pre">import</span> <span class="pre">unicode_literals</span></code><a class="headerlink" href="#from-future-import-unicode-literals" title="このヘッドラインへのパーマリンク">¶</a></h5>
<p>If you choose to use this future statement then all string literals in
Python 2 will be assumed to be Unicode (as is already the case in Python 3).
If you choose not to use this future statement then you should mark all of your
text strings with a <code class="docutils literal"><span class="pre">u</span></code> prefix and only support Python 3.3 or newer. But you
are <strong>strongly</strong> advised to do one or the other (<a class="reference external" href="http://packages.python.org/six">six</a> provides a function in
case you don&#8217;t want to use the future statement <strong>and</strong> you want to support
Python 3.2 or older).</p>
</div>
<div class="section" id="bytes-string-literals">
<h5>Bytes/string literals<a class="headerlink" href="#bytes-string-literals" title="このヘッドラインへのパーマリンク">¶</a></h5>
<p>This is a <strong>very</strong> important one. Prefix Python 2 strings that
are meant to contain bytes with a <code class="docutils literal"><span class="pre">b</span></code> prefix to very clearly delineate
what is and is not a Python 3 text string (<a class="reference external" href="http://packages.python.org/six">six</a> provides a function to use for
Python 2.5 compatibility).</p>
<p>This point cannot be stressed enough: make sure you know what all of your string
literals in Python 2 are meant to be in Python 3. Any string literal that
should be treated as bytes should have the <code class="docutils literal"><span class="pre">b</span></code> prefix. Any string literal
that should be Unicode/text in Python 2 should either have the <code class="docutils literal"><span class="pre">u</span></code> literal
(supported, but ignored, in Python 3.3 and later) or you should have
<code class="docutils literal"><span class="pre">from</span> <span class="pre">__future__</span> <span class="pre">import</span> <span class="pre">unicode_literals</span></code> at the top of the file. But the key
point is you should know how Python 3 will treat every one one of your string
literals and you should mark them as appropriate.</p>
<p>There are some differences between byte literals in Python 2 and those in
Python 3 thanks to the bytes type just being an alias to <code class="docutils literal"><span class="pre">str</span></code> in Python 2.
See the <a href="#id3"><span class="problematic" id="id4">`Handle Common &#8220;Gotchas&#8221;`_</span></a> section for what to watch out for.</p>
</div>
<div class="section" id="from-future-import-absolute-import">
<h5><code class="docutils literal"><span class="pre">from</span> <span class="pre">__future__</span> <span class="pre">import</span> <span class="pre">absolute_import</span></code><a class="headerlink" href="#from-future-import-absolute-import" title="このヘッドラインへのパーマリンク">¶</a></h5>
<p>Discussed in more detail below, but you should use this future statement to
prevent yourself from accidentally using implicit relative imports.</p>
</div>
</div>
<div class="section" id="supporting-python-2-5-and-newer-only">
<h4><a class="reference external" href="http://www.python.org/2.5.x">Python 2.5</a> 以降のサポート<a class="headerlink" href="#supporting-python-2-5-and-newer-only" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>もし <a class="reference external" href="http://www.python.org/2.5.x">Python 2.5</a> 以降をサポートする場合、 Python のいくつかの機能を利用できます。</p>
<div class="section" id="id1">
<h5><code class="docutils literal"><span class="pre">from</span> <span class="pre">__future__</span> <span class="pre">import</span> <span class="pre">absolute_import</span></code><a class="headerlink" href="#id1" title="このヘッドラインへのパーマリンク">¶</a></h5>
<p>Implicit relative imports (e.g., importing <code class="docutils literal"><span class="pre">spam.bacon</span></code> from within
<code class="docutils literal"><span class="pre">spam.eggs</span></code> with the statement <code class="docutils literal"><span class="pre">import</span> <span class="pre">bacon</span></code>) do not work in Python 3.
This future statement moves away from that and allows the use of explicit
relative imports (e.g., <code class="docutils literal"><span class="pre">from</span> <span class="pre">.</span> <span class="pre">import</span> <span class="pre">bacon</span></code>).</p>
<p>In <a class="reference external" href="http://www.python.org/2.5.x">Python 2.5</a> you must use
the __future__ statement to get to use explicit relative imports and prevent
implicit ones. In <a class="reference external" href="http://www.python.org/2.6.x">Python 2.6</a> explicit relative imports are available without
the statement, but you still want the __future__ statement to prevent implicit
relative imports. In <a class="reference external" href="http://www.python.org/2.7.x">Python 2.7</a> the __future__ statement is not needed. In
other words, unless you are only supporting Python 2.7 or a version earlier
than Python 2.5, use this __future__ statement.</p>
</div>
<div class="section" id="mark-all-unicode-strings-with-a-u-prefix">
<h5>全ての Unicode 文字列を <code class="docutils literal"><span class="pre">u</span></code> プリフィックスでマークする<a class="headerlink" href="#mark-all-unicode-strings-with-a-u-prefix" title="このヘッドラインへのパーマリンク">¶</a></h5>
<p>While Python 2.6 has a <code class="docutils literal"><span class="pre">__future__</span></code> statement to automatically cause Python 2
to treat all string literals as Unicode, Python 2.5 does not have that shortcut.
This means you should go through and mark all string literals with a <code class="docutils literal"><span class="pre">u</span></code>
prefix to turn them explicitly into text strings where appropriate and only
support Python 3.3 or newer. Otherwise use a project like <a class="reference external" href="http://packages.python.org/six">six</a> which provides a
function to pass all text string literals through.</p>
</div>
<div class="section" id="capturing-the-currently-raised-exception">
<h5>発生中の例外の捕捉<a class="headerlink" href="#capturing-the-currently-raised-exception" title="このヘッドラインへのパーマリンク">¶</a></h5>
<p>In Python 2.5 and earlier the syntax to access the current exception is:</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="k">try</span><span class="p">:</span>
  <span class="k">raise</span> <span class="ne">Exception</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">exc</span><span class="p">:</span>
  <span class="c"># Current exception is &#39;exc&#39;.</span>
  <span class="k">pass</span>
</pre></div>
</div>
<p>この構文は Python 3 では次の通り変更になりました(<a class="reference external" href="http://www.python.org/2.6.x">Python 2.6</a> 以降へはバックポートされました):</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="k">try</span><span class="p">:</span>
  <span class="k">raise</span> <span class="ne">Exception</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
  <span class="c"># Current exception is &#39;exc&#39;.</span>
  <span class="c"># In Python 3, &#39;exc&#39; is restricted to the block; in Python 2.6/2.7 it will &quot;leak&quot;.</span>
  <span class="k">pass</span>
</pre></div>
</div>
<p>Because of this syntax change you must change how you capture the current
exception in Python 2.5 and earlier to:</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="k">try</span><span class="p">:</span>
  <span class="k">raise</span> <span class="ne">Exception</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
  <span class="kn">import</span> <span class="nn">sys</span>
  <span class="n">exc</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
  <span class="c"># Current exception is &#39;exc&#39;.</span>
  <span class="k">pass</span>
</pre></div>
</div>
<p>現在発生中の例外に関する詳細な情報が必要なら、単に現在の例外インスタンスを参照する代わりに <a class="reference internal" href="../library/sys.html#sys.exc_info" title="sys.exc_info"><code class="xref py py-func docutils literal"><span class="pre">sys.exc_info()</span></code></a> を参照してください。ただし、たいていは必要ないでしょう。</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p>Python 3 でのtracebackオブジェクトはexceptionインスタンスの属性 <code class="docutils literal"><span class="pre">__traceback__</span></code> として取得できます。もしこのインスタンスがローカル変数として保存された場合、<code class="docutils literal"><span class="pre">except</span></code> ブロックの外側でも生存しつづけ、tracebackオブジェクトは現在の実行フレームとローカル変数の辞書との循環参照を生成してしまいます。結果として次の <a class="reference internal" href="../glossary.html#term-garbage-collection"><span class="xref std std-term">garbage collection</span></a> が実行されるまでの間この死んだリソースの解放が遅れてしまいます。</p>
<p class="last">Python 2 ではtracebackそのものを保存した場合のみこの問題が発生します(例: <a class="reference internal" href="../library/sys.html#sys.exc_info" title="sys.exc_info"><code class="xref py py-func docutils literal"><span class="pre">sys.exc_info()</span></code></a> の戻りタプルの3番目をローカル変数に保存したとき)。</p>
</div>
</div>
</div>
<div class="section" id="handle-common-gotchas">
<h4>よくある &#8220;Gotcha&#8221; (「なるほど！」) の扱い<a class="headerlink" href="#handle-common-gotchas" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>These are things to watch out for no matter what version of Python 2 you are
supporting which are not syntactic considerations.</p>
<div class="section" id="from-future-import-division">
<h5><code class="docutils literal"><span class="pre">from</span> <span class="pre">__future__</span> <span class="pre">import</span> <span class="pre">division</span></code><a class="headerlink" href="#from-future-import-division" title="このヘッドラインへのパーマリンク">¶</a></h5>
<p>Python 実行時の引数に <code class="docutils literal"><span class="pre">-Qnew</span></code> を指定することでも同じ結果が得られますが、この future 文を使うと Python 3 での割り算の振る舞いを導入できます(例: <code class="docutils literal"><span class="pre">1/2</span> <span class="pre">==</span> <span class="pre">0.5;</span> <span class="pre">1//2</span> <span class="pre">==</span> <span class="pre">0</span></code>)。</p>
</div>
<div class="section" id="specify-when-opening-a-file-as-binary">
<h5>バイナリファイルを開く際の設定<a class="headerlink" href="#specify-when-opening-a-file-as-binary" title="このヘッドラインへのパーマリンク">¶</a></h5>
<p>Windows環境で作業しているのでなければ、バイナリファイルを開く際に <code class="docutils literal"><span class="pre">b</span></code> を付けるか心配しなくてもよい場合があります(例: バイナリ読み込み時に <code class="docutils literal"><span class="pre">rb</span></code> を指定するなど)。 Python 3 では、バイナリファイルとテキストファイルははっきりと分けられて相互変換できません。詳細は <a class="reference internal" href="../library/io.html#module-io" title="io: Core tools for working with streams."><code class="xref py py-mod docutils literal"><span class="pre">io</span></code></a> モジュールを参照してください。そのため、それぞれのファイルについてバイナリアクセス(byte列のみ読み書きを許可する)とするのか、もしくはテキストアクセス(Unicodeの文字列のみ読み書きを許可する)のかを判断 <strong>しなければなりません</strong>。</p>
</div>
<div class="section" id="text-files">
<h5>テキストファイル<a class="headerlink" href="#text-files" title="このヘッドラインへのパーマリンク">¶</a></h5>
<p>テキストファイルは <code class="docutils literal"><span class="pre">open()</span></code> 関数によって作成されますが、 Python 2 ではbyte列が返却され、 Python 3 ではUnicode文字列が返却されます。この点は移植の戦略に依って問題となりえます。</p>
<p>もし Python 2 でUnicode文字を受け取りたい場合は二つの方法があります:</p>
<ul class="simple">
<li><p class="first">Python 2.6 以降では、 <a class="reference internal" href="../library/io.html#io.open" title="io.open"><code class="xref py py-func docutils literal"><span class="pre">io.open()</span></code></a> を利用してください。 <a class="reference internal" href="../library/io.html#io.open" title="io.open"><code class="xref py py-func docutils literal"><span class="pre">io.open()</span></code></a> は Python 2 と 3 で基本的に同じ関数ですので、この問題を解決してくれるでしょう。</p>
</li>
<li><p class="first">もし Python 2.6 以前の互換性が必要であれば、 <a class="reference internal" href="../library/codecs.html#codecs.open" title="codecs.open"><code class="xref py py-func docutils literal"><span class="pre">codecs.open()</span></code></a> を代わりに使用してください。この関数は Python 2 でUnicode文字を返却することを保証してくれるでしょう。</p>
</li>
</ul>
</div>
<div class="section" id="subclass-object">
<h5>サブクラス <code class="docutils literal"><span class="pre">object</span></code><a class="headerlink" href="#subclass-object" title="このヘッドラインへのパーマリンク">¶</a></h5>
<p>新しいスタイルのクラス定義は <a class="reference external" href="http://www.python.org/2.2.x">Python 2.2</a> から導入されました。メソッド解決順序に関係する奇妙なエッジケースを避けるために、必ず <code class="docutils literal"><span class="pre">object</span></code> をサブクラス化するようにしてください。これは Python 3 でも完全に有効です (ただしすべてのクラスが <code class="docutils literal"><span class="pre">object</span></code> を暗黙に継承するので必要ではありません)。</p>
</div>
<div class="section" id="deal-with-the-bytes-string-dichotomy">
<h5>byte/string 二分問題への対処<a class="headerlink" href="#deal-with-the-bytes-string-dichotomy" title="このヘッドラインへのパーマリンク">¶</a></h5>
<p>One of the biggest issues people have when porting code to Python 3 is handling
the bytes/string dichotomy. Because Python 2 allowed the <code class="docutils literal"><span class="pre">str</span></code> type to hold
textual data, people have over the years been rather loose in their delineation
of what <code class="docutils literal"><span class="pre">str</span></code> instances held text compared to bytes. In Python 3 you cannot
be so care-free anymore and need to properly handle the difference. The key to
handling this issue is to make sure that <strong>every</strong> string literal in your
Python 2 code is either syntactically or functionally marked as either bytes or
text data. After this is done you then need to make sure your APIs are designed
to either handle a specific type or made to be properly polymorphic.</p>
<div class="section" id="mark-up-python-2-string-literals">
<h6>Python 2 の文字列リテラルのマークアップ<a class="headerlink" href="#mark-up-python-2-string-literals" title="このヘッドラインへのパーマリンク">¶</a></h6>
<p>最初にすることは、 Python 2 のすべての文字列リテラルをbyte列か文字列か指定することです。もし Python 2.6 以降のみをサポートする場合は、byte列の先頭には <code class="docutils literal"><span class="pre">b</span></code> を付け、文字列の先頭には <code class="docutils literal"><span class="pre">u</span></code> を付けるもしくは <code class="docutils literal"><span class="pre">unicode_literals</span></code> 行を使うことで完遂できます。</p>
<p>もし Python 2.6 以前のバージョンをサポートする場合は、<a class="reference external" href="http://packages.python.org/six">six</a> プロジェクトを利用し <code class="docutils literal"><span class="pre">b()</span></code> 関数を使ってbyte列を指定してください。文字列に対してはsixプロジェクトの <code class="docutils literal"><span class="pre">u()</span></code> 関数か <code class="docutils literal"><span class="pre">u</span></code> を先頭に記述してください。</p>
</div>
<div class="section" id="decide-what-apis-will-accept">
<h6>APIが何を受け取るかを決める<a class="headerlink" href="#decide-what-apis-will-accept" title="このヘッドラインへのパーマリンク">¶</a></h6>
<p>Python 2 では偶然ながら簡単にbyte列と文字列を受け取るAPIを作成できました。しかし Python 3 は型の扱いに厳密であるため、byte列と文字列をごちゃまぜに使うことはうまくいかない傾向にあります。</p>
<p>Python 2.6 での辞書 <code class="docutils literal"><span class="pre">{b'a':</span> <span class="pre">'bytes',</span> <span class="pre">u'a':</span> <span class="pre">'text'}</span></code> を見て見ましょう。このコードは <code class="docutils literal"><span class="pre">b'a'</span> <span class="pre">==</span> <span class="pre">u'a'</span></code> が成り立つため <code class="docutils literal"><span class="pre">{u'a':</span> <span class="pre">'text'}</span></code> となります。しかし Python 3 では記述どおり <code class="docutils literal"><span class="pre">{b'a':</span> <span class="pre">'bytes',</span> <span class="pre">'a':</span> <span class="pre">'text'}</span></code> が生成されます。つまりデータを失うことがありません。同様の問題は Python 2 から 3 への移植作業において散見されます。</p>
<p>これはつまり Python 2 と 3 で一貫した動作となるように、どのAPIが何を受け取るのかを選択しなければならないということです。</p>
</div>
<div class="section" id="bytes-unicode-comparison">
<h6>Byte列/Unicode文字列の比較<a class="headerlink" href="#bytes-unicode-comparison" title="このヘッドラインへのパーマリンク">¶</a></h6>
<p>Python 3 では、byte列とUnicode文字列の併用はほとんどの場合禁止されています。 Python 2 では暗黙の型変換を試みるところ、 Python 3 では <a class="reference internal" href="../library/exceptions.html#TypeError" title="TypeError"><code class="xref py py-class docutils literal"><span class="pre">TypeError</span></code></a> が発生します。しかしながら例外を発生しない勘違いしやすいケースが一つあります:</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="s">&quot;&quot;</span> <span class="o">==</span> <span class="s">&quot;&quot;</span>
<span class="go">False</span>
</pre></div>
</div>
<p>これは Python では等価性の比較において例外を発生させてはいけない (そして型が異なるので <code class="docutils literal"><span class="pre">False</span></code> を返却する) ためです。しかしながら、このような暗黙の比較が実行されると、誤って移植された Python 3 のコードはバグだらけの振る舞いとなってしまいます。これを検出するため、 Python 3 では <code class="docutils literal"><span class="pre">-b</span></code> フラグを付けることで警告を発生させられます:</p>
<div class="highlight-python3"><div class="highlight"><pre>$ python3 -b
&gt;&gt;&gt; b&quot;&quot; == &quot;&quot;
__main__:1: BytesWarning: Comparison between bytes and string
False
</pre></div>
</div>
<p>警告を例外にするには、<code class="docutils literal"><span class="pre">-bb</span></code> フラグを用います:</p>
<div class="highlight-python3"><div class="highlight"><pre>$ python3 -bb
&gt;&gt;&gt; b&quot;&quot; == &quot;&quot;
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
BytesWarning: Comparison between bytes and string
</pre></div>
</div>
</div>
</div>
<div class="section" id="indexing-bytes-objects">
<h5>byte列のインデックス参照<a class="headerlink" href="#indexing-bytes-objects" title="このヘッドラインへのパーマリンク">¶</a></h5>
<p>別の隠れた驚きの変更に、 Python 3 でのbyte列のインデックス参照時の振る舞いがあります:</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="s">&quot;xyz&quot;</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">120</span>
</pre></div>
</div>
<p>このように、 Python 3 のbyteオブジェクト(<a class="reference internal" href="../library/functions.html#bytearray" title="bytearray"><code class="xref py py-class docutils literal"><span class="pre">bytearray</span></code></a> も同様)は整数の配列なのです。しかし Python 2 から変換したコードは、byte列をインデックス参照したら整数ではなく別の新たなbyte列が生成されると想定していることがよくあります。これらの振る舞いとうまくやっていくため、次のスライスを利用してください:</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="s">&quot;xyz&quot;</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
<span class="go">b&#39;x&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="s">&quot;xyz&quot;</span><span class="p">[</span><span class="n">n</span><span class="p">:</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
<span class="go">b&#39;y&#39;</span>
</pre></div>
</div>
<p>最後の項目についてですが、範囲外のスライスが例外の発生の代わりに空のbyte列を返却するということです:</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="s">&quot;xyz&quot;</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">IndexError</span>: <span class="n">index out of range</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="s">&quot;xyz&quot;</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
<span class="go">b&#39;&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="str-unicode">
<h5><code class="docutils literal"><span class="pre">__str__()</span></code>/<code class="docutils literal"><span class="pre">__unicode__()</span></code><a class="headerlink" href="#str-unicode" title="このヘッドラインへのパーマリンク">¶</a></h5>
<p>Python 2 ではオブジェクトは自身に対する通常の文字列とUnicode文字列の二つの表現を指定できました。 Python 3 では一つの文字列表現しか指定できません。このため、<code class="docutils literal"><span class="pre">__str__()</span></code> メソッド内でうっかり間違いを犯して予測できない結果を引き起こしてしまうようなことになります(例: <code class="docutils literal"><span class="pre">__str__()</span></code> の内部で <code class="docutils literal"><span class="pre">unicode(self).encode('utf8')</span></code> を使用すると無限再帰呼び出しとなります)。</p>
<p>You can use a mixin class to work around this. This allows you to only define a
<code class="docutils literal"><span class="pre">__unicode__()</span></code> method for your class and let the mixin derive
<code class="docutils literal"><span class="pre">__str__()</span></code> for you (code from
<a class="reference external" href="http://lucumr.pocoo.org/2011/1/22/forwards-compatible-python/">http://lucumr.pocoo.org/2011/1/22/forwards-compatible-python/</a>):</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">sys</span>

<span class="k">class</span> <span class="nc">UnicodeMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

  <span class="sd">&quot;&quot;&quot;Mixin class to handle defining the proper __str__/__unicode__</span>
<span class="sd">  methods in Python 2 or 3.&quot;&quot;&quot;</span>

  <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span> <span class="c"># Python 3</span>
      <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
          <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__unicode__</span><span class="p">()</span>
  <span class="k">else</span><span class="p">:</span>  <span class="c"># Python 2</span>
      <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
          <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__unicode__</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf8&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Spam</span><span class="p">(</span><span class="n">UnicodeMixin</span><span class="p">):</span>

  <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">return</span> <span class="s">u&#39;spam-spam-bacon-spam&#39;</span>  <span class="c"># 2to3 will remove the &#39;u&#39; prefix</span>
</pre></div>
</div>
</div>
<div class="section" id="don-t-index-on-exceptions">
<h5>例外をインデックス参照しないこと<a class="headerlink" href="#don-t-index-on-exceptions" title="このヘッドラインへのパーマリンク">¶</a></h5>
<p>Python 2 では下記のコードは動作します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">exc</span> <span class="o">=</span> <span class="ne">Exception</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">exc</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">exc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c"># Python 2 only!</span>
<span class="go">2</span>
</pre></div>
</div>
<p>しかし Python 3 で例外を直接インデックス参照するとエラーになります。インデックス参照できるのは <a class="reference internal" href="../library/exceptions.html#BaseException.args" title="BaseException.args"><code class="xref py py-attr docutils literal"><span class="pre">BaseException.args</span></code></a> 属性だけで、これは <a class="reference internal" href="../reference/datamodel.html#object.__init__" title="object.__init__"><code class="xref py py-meth docutils literal"><span class="pre">__init__()</span></code></a> メソッドに渡されたすべての引数からなる配列です。</p>
<p>より良い方法は例外が提供するドキュメント化された属性を利用することです。</p>
</div>
<div class="section" id="don-t-use-getslice-friends">
<h5><code class="docutils literal"><span class="pre">__getslice__</span></code> ファミリーは使わないこと<a class="headerlink" href="#don-t-use-getslice-friends" title="このヘッドラインへのパーマリンク">¶</a></h5>
<p>長い間廃止とされてきましたが、 Python3ではついに <code class="docutils literal"><span class="pre">__getslice__()</span></code> をサポートしなくなり、<a class="reference internal" href="../reference/datamodel.html#object.__getitem__" title="object.__getitem__"><code class="xref py py-meth docutils literal"><span class="pre">__getitem__()</span></code></a> ファミリーへその機能を委譲しました。</p>
</div>
<div class="section" id="updating-doctests">
<h5>doctestsのアップデート<a class="headerlink" href="#updating-doctests" title="このヘッドラインへのパーマリンク">¶</a></h5>
<p>Don&#8217;t forget to make them Python 2/3 compatible as well. If you wrote a
monolithic set of doctests (e.g., a single docstring containing all of your
doctests), you should at least consider breaking the doctests up into smaller
pieces to make it more manageable to fix. Otherwise it might very well be worth
your time and effort to port your tests to <a class="reference internal" href="../library/unittest.html#module-unittest" title="unittest: Unit testing framework for Python."><code class="xref py py-mod docutils literal"><span class="pre">unittest</span></code></a>.</p>
</div>
<div class="section" id="update-map-for-imbalanced-input-sequences">
<h5>Update <code class="docutils literal"><span class="pre">map</span></code> for imbalanced input sequences<a class="headerlink" href="#update-map-for-imbalanced-input-sequences" title="このヘッドラインへのパーマリンク">¶</a></h5>
<p>With Python 2, when <code class="docutils literal"><span class="pre">map</span></code> was given more than one input sequence it would pad
the shorter sequences with <cite>None</cite> values, returning a sequence as long as the
longest input sequence.</p>
<p>With Python 3, if the input sequences to <code class="docutils literal"><span class="pre">map</span></code> are of unequal length, <code class="docutils literal"><span class="pre">map</span></code>
will stop at the termination of the shortest of the sequences. For full
compatibility with <code class="docutils literal"><span class="pre">map</span></code> from Python 2.x, wrap the sequence arguments in
<a class="reference internal" href="../library/itertools.html#itertools.zip_longest" title="itertools.zip_longest"><code class="xref py py-func docutils literal"><span class="pre">itertools.zip_longest()</span></code></a>, e.g. <code class="docutils literal"><span class="pre">map(func,</span> <span class="pre">*sequences)</span></code> becomes
<code class="docutils literal"><span class="pre">list(map(func,</span> <span class="pre">itertools.zip_longest(*sequences)))</span></code>.</p>
</div>
</div>
</div>
<div class="section" id="eliminate-3-warnings">
<h3><code class="docutils literal"><span class="pre">-3</span></code> 警告の除去<a class="headerlink" href="#eliminate-3-warnings" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>When you run your application&#8217;s test suite, run it using the <code class="docutils literal"><span class="pre">-3</span></code> flag passed
to Python. This will cause various warnings to be raised during execution about
things that are semantic changes between Python 2 and 3. Try to eliminate those
warnings to make your code even more portable to Python 3.</p>
</div>
</div>
<div class="section" id="alternative-approaches">
<h2>Alternative Approaches<a class="headerlink" href="#alternative-approaches" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>While supporting Python 2 &amp; 3 simultaneously is typically the preferred choice
by people so that they can continue to improve code and have it work for the
most number of users, your life may be easier if you only have to support one
major version of Python going forward.</p>
<div class="section" id="supporting-only-python-3-going-forward-from-python-2-code">
<h3>Supporting Only Python 3 Going Forward From Python 2 Code<a class="headerlink" href="#supporting-only-python-3-going-forward-from-python-2-code" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>If you have Python 2 code but going forward only want to improve it as Python 3
code, then you can use <a class="reference external" href="http://docs.python.org/2/library/2to3.html">2to3</a> to translate your Python 2 code to Python 3 code.
This is only recommended, though, if your current version of your project is
going into maintenance mode and you want all new features to be exclusive to
Python 3.</p>
</div>
<div class="section" id="backporting-python-3-code-to-python-2">
<h3>Backporting Python 3 code to Python 2<a class="headerlink" href="#backporting-python-3-code-to-python-2" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>If you have Python 3 code and have little interest in supporting Python 2 you
can use <a class="reference external" href="https://pypi.python.org/pypi/3to2">3to2</a> to translate from Python 3 code to Python 2 code. This is only
recommended if you don&#8217;t plan to heavily support Python 2 users. Otherwise
write your code for Python 3 and then backport as far back as you want. This
is typically easier than going from Python 2 to 3 as you will have worked out
any difficulties with e.g. bytes/strings, etc.</p>
</div>
</div>
<div class="section" id="other-resources">
<h2>他のリソース<a class="headerlink" href="#other-resources" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>The authors of the following blog posts, wiki pages, and books deserve special
thanks for making public their tips for porting Python 2 code to Python 3 (and
thus helping provide information for this document and its various revisions
over the years):</p>
<ul class="simple">
<li><a class="reference external" href="http://wiki.python.org/moin/PortingPythonToPy3k">http://wiki.python.org/moin/PortingPythonToPy3k</a></li>
<li><a class="reference external" href="http://python3porting.com/">http://python3porting.com/</a></li>
<li><a class="reference external" href="http://docs.pythonsprints.com/python3_porting/py-porting.html">http://docs.pythonsprints.com/python3_porting/py-porting.html</a></li>
<li><a class="reference external" href="http://techspot.zzzeek.org/2011/01/24/zzzeek-s-guide-to-python-3-porting/">http://techspot.zzzeek.org/2011/01/24/zzzeek-s-guide-to-python-3-porting/</a></li>
<li><a class="reference external" href="http://dabeaz.blogspot.com/2011/01/porting-py65-and-my-superboard-to.html">http://dabeaz.blogspot.com/2011/01/porting-py65-and-my-superboard-to.html</a></li>
<li><a class="reference external" href="http://lucumr.pocoo.org/2011/1/22/forwards-compatible-python/">http://lucumr.pocoo.org/2011/1/22/forwards-compatible-python/</a></li>
<li><a class="reference external" href="http://lucumr.pocoo.org/2010/2/11/porting-to-python-3-a-guide/">http://lucumr.pocoo.org/2010/2/11/porting-to-python-3-a-guide/</a></li>
<li><a class="reference external" href="https://wiki.ubuntu.com/Python/3">https://wiki.ubuntu.com/Python/3</a></li>
</ul>
<p>もしこの文書に何か足りない、追加すべきだと感じた場合は遠慮なく <a class="reference external" href="http://mail.python.org/mailman/listinfo/python-porting">python-porting</a> のメーリングリストへ投稿してください。</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../contents.html">目次</a></h3>
  <ul>
<li><a class="reference internal" href="#">Python 2 から Python 3 への移植</a><ul>
<li><a class="reference internal" href="#the-short-version">The Short Version</a></li>
<li><a class="reference internal" href="#before-you-begin">Before You Begin</a></li>
<li><a class="reference internal" href="#writing-source-compatible-python-2-3-code">Writing Source-Compatible Python 2/3 Code</a><ul>
<li><a class="reference internal" href="#projects-to-consider">Projects to Consider</a></li>
<li><a class="reference internal" href="#tips-tricks">Tips &amp; Tricks</a><ul>
<li><a class="reference internal" href="#support-python-2-7">Python 2.7 のサポート</a></li>
<li><a class="reference internal" href="#try-to-support-python-2-6-and-newer-only">Python 2.6 以降のバージョンのサポート</a><ul>
<li><a class="reference internal" href="#from-future-import-print-function"><code class="docutils literal"><span class="pre">from</span> <span class="pre">__future__</span> <span class="pre">import</span> <span class="pre">print_function</span></code></a></li>
<li><a class="reference internal" href="#from-future-import-unicode-literals"><code class="docutils literal"><span class="pre">from</span> <span class="pre">__future__</span> <span class="pre">import</span> <span class="pre">unicode_literals</span></code></a></li>
<li><a class="reference internal" href="#bytes-string-literals">Bytes/string literals</a></li>
<li><a class="reference internal" href="#from-future-import-absolute-import"><code class="docutils literal"><span class="pre">from</span> <span class="pre">__future__</span> <span class="pre">import</span> <span class="pre">absolute_import</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#supporting-python-2-5-and-newer-only">Python 2.5 以降のサポート</a><ul>
<li><a class="reference internal" href="#id1"><code class="docutils literal"><span class="pre">from</span> <span class="pre">__future__</span> <span class="pre">import</span> <span class="pre">absolute_import</span></code></a></li>
<li><a class="reference internal" href="#mark-all-unicode-strings-with-a-u-prefix">全ての Unicode 文字列を <code class="docutils literal"><span class="pre">u</span></code> プリフィックスでマークする</a></li>
<li><a class="reference internal" href="#capturing-the-currently-raised-exception">発生中の例外の捕捉</a></li>
</ul>
</li>
<li><a class="reference internal" href="#handle-common-gotchas">よくある &#8220;Gotcha&#8221; (「なるほど！」) の扱い</a><ul>
<li><a class="reference internal" href="#from-future-import-division"><code class="docutils literal"><span class="pre">from</span> <span class="pre">__future__</span> <span class="pre">import</span> <span class="pre">division</span></code></a></li>
<li><a class="reference internal" href="#specify-when-opening-a-file-as-binary">バイナリファイルを開く際の設定</a></li>
<li><a class="reference internal" href="#text-files">テキストファイル</a></li>
<li><a class="reference internal" href="#subclass-object">サブクラス <code class="docutils literal"><span class="pre">object</span></code></a></li>
<li><a class="reference internal" href="#deal-with-the-bytes-string-dichotomy">byte/string 二分問題への対処</a><ul>
<li><a class="reference internal" href="#mark-up-python-2-string-literals">Python 2 の文字列リテラルのマークアップ</a></li>
<li><a class="reference internal" href="#decide-what-apis-will-accept">APIが何を受け取るかを決める</a></li>
<li><a class="reference internal" href="#bytes-unicode-comparison">Byte列/Unicode文字列の比較</a></li>
</ul>
</li>
<li><a class="reference internal" href="#indexing-bytes-objects">byte列のインデックス参照</a></li>
<li><a class="reference internal" href="#str-unicode"><code class="docutils literal"><span class="pre">__str__()</span></code>/<code class="docutils literal"><span class="pre">__unicode__()</span></code></a></li>
<li><a class="reference internal" href="#don-t-index-on-exceptions">例外をインデックス参照しないこと</a></li>
<li><a class="reference internal" href="#don-t-use-getslice-friends"><code class="docutils literal"><span class="pre">__getslice__</span></code> ファミリーは使わないこと</a></li>
<li><a class="reference internal" href="#updating-doctests">doctestsのアップデート</a></li>
<li><a class="reference internal" href="#update-map-for-imbalanced-input-sequences">Update <code class="docutils literal"><span class="pre">map</span></code> for imbalanced input sequences</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#eliminate-3-warnings"><code class="docutils literal"><span class="pre">-3</span></code> 警告の除去</a></li>
</ul>
</li>
<li><a class="reference internal" href="#alternative-approaches">Alternative Approaches</a><ul>
<li><a class="reference internal" href="#supporting-only-python-3-going-forward-from-python-2-code">Supporting Only Python 3 Going Forward From Python 2 Code</a></li>
<li><a class="reference internal" href="#backporting-python-3-code-to-python-2">Backporting Python 3 code to Python 2</a></li>
</ul>
</li>
<li><a class="reference internal" href="#other-resources">他のリソース</a></li>
</ul>
</li>
</ul>

  <h4>前のトピックへ</h4>
  <p class="topless"><a href="index.html"
                        title="前の章へ">Python HOWTO</a></p>
  <h4>次のトピックへ</h4>
  <p class="topless"><a href="cporting.html"
                        title="次の章へ">Python 3 への拡張モジュール移植</a></p>
<h3>このページ</h3>
<ul class="this-page-menu">
  <li><a href="../bugs.html">Report a Bug</a></li>
  <li><a href="../_sources/howto/pyporting.txt"
         rel="nofollow">Show Source</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>クイック検索</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="検索" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    モジュール、クラス、または関数名を入力してください
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総合索引"
             >索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="cporting.html" title="Python 3 への拡張モジュール移植"
             >次へ</a> |</li>
        <li class="right" >
          <a href="index.html" title="Python HOWTO"
             >前へ</a> |</li>
        <li><img src="../_static/py.png" alt=""
                 style="vertical-align: middle; margin-top: -1px"/></li>
        <li><a href="http://www.python.org/">Python</a> &raquo;</li>
        <li>
          <span class="version_switcher_placeholder">3.3.6</span>
          <a href="../index.html">Documentation</a> &raquo;
        </li>

          <li class="nav-item nav-item-1"><a href="index.html" >Python HOWTO</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
    &copy; <a href="../copyright.html">Copyright</a> 1990-2015, Python Software Foundation.
    <br />
    The Python Software Foundation is a non-profit corporation.
    <a href="http://www.python.org/psf/donations/">Please donate.</a>
    <br />
    Last updated on Dec 28, 2015.
    <a href="../bugs.html">Found a bug</a>?
    <br />
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.1.
    <br />
    <a href="https://github.com/python-doc-ja/python-doc-ja">Pythonドキュメント日本語翻訳プロジェクト</a>
    によって翻訳されました。
    <a href="https://github.com/python-doc-ja/python-doc-ja/issues">誤訳を報告する。</a>
    </div>

  </body>
</html>