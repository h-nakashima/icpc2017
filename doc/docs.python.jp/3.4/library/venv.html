<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>28.3. venv — 仮想環境の作成 &mdash; Python 3.4.3 ドキュメント</title>
    
    <link rel="stylesheet" href="../_static/pydoctheme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.4.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Python 3.4.3 ドキュメント 内を検索"
          href="../_static/opensearch.xml"/>
    <link rel="author" title="このドキュメントについて" href="../about.html" />
    <link rel="copyright" title="著作権" href="../copyright.html" />
    <link rel="top" title="Python 3.4.3 ドキュメント" href="../contents.html" />
    <link rel="up" title="28. ソフトウェア・パッケージと配布" href="distribution.html" />
    <link rel="next" title="29. Python ランタイムサービス" href="python.html" />
    <link rel="prev" title="28.2. ensurepip — pip インストーラのブートストラップ" href="ensurepip.html" />
    <link rel="shortcut icon" type="image/png" href="../_static/py.png" />
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <script type="text/javascript" src="../_static/_jp.js"></script>
    <script type="text/javascript" src="../_static/version_switch.js"></script>
    
 

  <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-34175846-1', 'python.jp');
        ga('send', 'pageview');

      </script>
  <body role="document">  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総合索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="python.html" title="29. Python ランタイムサービス"
             accesskey="N">次へ</a> |</li>
        <li class="right" >
          <a href="ensurepip.html" title="28.2. ensurepip — pip インストーラのブートストラップ"
             accesskey="P">前へ</a> |</li>
        <li><img src="../_static/py.png" alt=""
                 style="vertical-align: middle; margin-top: -1px"/></li>
        <li><a href="https://www.python.org/">Python</a> &raquo;</li>
        <li>
          <span class="version_switcher_placeholder">3.4.3</span>
          <a href="../index.html">Documentation</a> &raquo;
        </li>

          <li class="nav-item nav-item-1"><a href="index.html" >Python 標準ライブラリ</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="distribution.html" accesskey="U">28. ソフトウェア・パッケージと配布</a> &raquo;</li> 
      </ul>
    </div>    

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-venv">
<span id="venv-creation-of-virtual-environments"></span><h1>28.3. <a class="reference internal" href="#module-venv" title="venv: Creation of virtual environments."><code class="xref py py-mod docutils literal"><span class="pre">venv</span></code></a> &#8212; 仮想環境の作成<a class="headerlink" href="#module-venv" title="このヘッドラインへのパーマリンク">¶</a></h1>
<div class="versionadded" id="index-0">
<p><span class="versionmodified">バージョン 3.3 で追加.</span></p>
</div>
<p><strong>ソースコード:</strong> <a class="reference external" href="https://hg.python.org/cpython/file/3.4/Lib/venv">Lib/venv</a></p>
<hr class="docutils" />
<p><a class="reference internal" href="#module-venv" title="venv: Creation of virtual environments."><code class="xref py py-mod docutils literal"><span class="pre">venv</span></code></a> モジュールは、軽量な &#8220;仮想環境&#8221; の作成のサポートを提供します。仮想環境には、仮想環境ごとの site ディレクトリがあり、これはシステムの site ディレクトリから分離させることができます。それぞれの仮想環境には、それ自身の Python バイナリ (様々な Python バージョンで環境を作成できます) があり、仮想環境ごとの site ディレクトリに独立した Python パッケージ群をインストールできます。</p>
<p>Python仮想環境に関してより詳しくは <span class="target" id="index-4"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0405"><strong>PEP 405</strong></a> を参照してください。</p>
<div class="section" id="creating-virtual-environments">
<h2>28.3.1. 仮想環境の作成<a class="headerlink" href="#creating-virtual-environments" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="#venv-def"><span>virtual environments</span></a> の生成は <code class="docutils literal"><span class="pre">pyvenv</span></code> スクリプトを実行することで行えます:</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="n">pyvenv</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">new</span><span class="o">/</span><span class="n">virtual</span><span class="o">/</span><span class="n">environment</span>
</pre></div>
</div>
<p>このコマンドを実行すると、ターゲットディレクトリ (および必要なだけの親ディレクトリ) が作成され、その中に <code class="docutils literal"><span class="pre">pyvenv.cfg</span></code> ファイルが置かれます。そのファイルの <code class="docutils literal"><span class="pre">home</span></code> キーはこのコマンドを呼び出した Python のインストール場所を指します。このコマンドはまた、<code class="docutils literal"><span class="pre">python</span></code> バイナリのコピーを含む <code class="docutils literal"><span class="pre">bin</span></code> サブディレクトリを作成します (Windows では、<code class="docutils literal"><span class="pre">python</span></code> バイナリを含む <code class="docutils literal"><span class="pre">Scripts</span></code> サブディレクトリを作成します)。さらに、<code class="docutils literal"><span class="pre">lib/pythonX.Y/site-packages</span></code> (Windows では <code class="docutils literal"><span class="pre">Lib\site-packages</span></code>) サブディレクトリも (最初は空の状態で) 作成します。</p>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<p class="last"><a class="reference external" href="https://packaging.python.org/en/latest/installing.html#virtual-environments">Python Packaging User Guide: Creating and using virtual environments</a></p>
</div>
<p>Windows では、関連する PATH および PATHEXT の設定をしていないなら、以下のように <code class="docutils literal"><span class="pre">pyvenv</span></code> スクリプトを呼び出せます:</p>
<div class="highlight-none"><div class="highlight"><pre>c:\Temp&gt;c:\Python34\python c:\Python34\Tools\Scripts\pyvenv.py myenv
</pre></div>
</div>
<p>もしくは以下でも同じです:</p>
<div class="highlight-none"><div class="highlight"><pre>c:\Temp&gt;c:\Python34\python -m venv myenv
</pre></div>
</div>
<p>このコマンドを、<code class="docutils literal"><span class="pre">-h</span></code> をつけて実行すると、利用できるオプションが表示されます:</p>
<div class="highlight-none"><div class="highlight"><pre>usage: venv [-h] [--system-site-packages] [--symlinks] [--clear]
            [--upgrade] [--without-pip] ENV_DIR [ENV_DIR ...]

Creates virtual Python environments in one or more target directories.

positional arguments:
  ENV_DIR             A directory to create the environment in.

optional arguments:
  -h, --help             show this help message and exit
  --system-site-packages Give access to the global site-packages dir to the
                         virtual environment.
  --symlinks             Try to use symlinks rather than copies, when symlinks
                         are not the default for the platform.
  --copies               Try to use copies rather than symlinks, even when
                         symlinks are the default for the platform.
  --clear                Delete the environment directory if it already exists.
                         If not specified and the directory exists, an error is
                         raised.
  --upgrade              Upgrade the environment directory to use this version
                         of Python, assuming Python has been upgraded in-place.
  --without-pip          Skips installing or upgrading pip in the virtual
                         environment (pip is bootstrapped by default)
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">venv</span></code> 機能がどのように起動されたかによって使用法のメッセージが微妙に変わるかもしれません。例えば <code class="docutils literal"><span class="pre">venv</span></code> でなく <code class="docutils literal"><span class="pre">pyvenv</span></code> について述べるかもしれません。</p>
<div class="versionchanged">
<p><span class="versionmodified">バージョン 3.4 で変更: </span>デフォルトで pip をインストールします。<code class="docutils literal"><span class="pre">--without-pip</span></code> と <code class="docutils literal"><span class="pre">--copies</span></code> オプションを追加しました。</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified">バージョン 3.4 で変更: </span>以前のバージョンでは <code class="docutils literal"><span class="pre">--clear</span></code> か <code class="docutils literal"><span class="pre">--upgrade</span></code> オプションが指定されていない限り、対象のディレクトリが既に存在していた場合はエラーを送出していました。
現在は、既存のディレクトリが指定された場合、中身が削除されディレクトリは新規作成されたように扱われます。</p>
</div>
<p>作成された <code class="docutils literal"><span class="pre">pyvenv.cfg</span></code> ファイルには、<code class="docutils literal"><span class="pre">include-system-site-packages</span></code> キーも含まれます。これは <code class="docutils literal"><span class="pre">venv</span></code> が <code class="docutils literal"><span class="pre">--system-site-packages</span></code> オプションをつけて実行されたなら <code class="docutils literal"><span class="pre">true</span></code> で、そうでなければ <code class="docutils literal"><span class="pre">false</span></code> です。</p>
<p><code class="docutils literal"><span class="pre">--without-pip</span></code> オプションが与えられない限り、<code class="docutils literal"><span class="pre">pip</span></code> を仮想環境でブートするために <a class="reference internal" href="ensurepip.html#module-ensurepip" title="ensurepip: Bootstrapping the &quot;pip&quot; installer into an existing Python installation or virtual environment."><code class="xref py py-mod docutils literal"><span class="pre">ensurepip</span></code></a> が呼ばれます。</p>
<p><code class="docutils literal"><span class="pre">pyvenv</span></code> に複数のパスを与えることもできます。この場合、与えられたそれぞれのパスに、与えられたオプションに従って、同様の仮想環境が作成されます。</p>
<p>一旦 venv が作成されれば、venv のバイナリディレクトリにあるスクリプトで &#8220;有効化&#8221; できます。スクリプトの呼び出しはプラットフォーム固有です:</p>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="24%" />
<col width="58%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><p class="first last">プラットフォーム</p>
</th>
<th class="head"><p class="first last">シェル</p>
</th>
<th class="head"><p class="first last">仮想環境を有効化するためのコマンド</p>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Posix</td>
<td>bash/zsh</td>
<td>$ source &lt;venv&gt;/bin/activate</td>
</tr>
<tr class="row-odd"><td>&nbsp;</td>
<td>fish</td>
<td>$ . &lt;venv&gt;/bin/activate.fish</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>csh/tcsh</td>
<td>$ source &lt;venv&gt;/bin/activate.csh</td>
</tr>
<tr class="row-odd"><td>Windows</td>
<td>cmd.exe</td>
<td>C:&gt; &lt;venv&gt;/Scripts/activate.bat</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>PowerShell</td>
<td>PS C:&gt; &lt;venv&gt;/Scripts/Activate.ps1</td>
</tr>
</tbody>
</table>
<p>環境の有効化に特別な指定は <em>必要</em> ありません。有効化は venv のバイナリディレクトリをパスの最初に加えることで、&#8221;python&#8221; で venv の Python インタプリタが呼び出されるようにし、インストールされたスクリプトをフルパス無しで実行できるようにするだけです。しかし、インストールされたすべてのスクリプトは有効化しなくても実行可能で、venv の Python で自動的に実行されなければなりません。</p>
<p>シェルで &#8220;deactivate&#8221; と入力することで、venv を無効化できます。正確な機構はプラットフォーム固有です。例えば、Bash の有効化スクリプトは &#8220;deactivate&#8221; 関数を定義しています。一方 Windows では、venv が作成されるときに <code class="docutils literal"><span class="pre">deactivate.bat</span></code> と <code class="docutils literal"><span class="pre">Deactivate.ps1</span></code> という別々のスクリプトがインストールされます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.4 で追加: </span><code class="docutils literal"><span class="pre">fish</span></code> および <code class="docutils literal"><span class="pre">csh</span></code> 有効化スクリプト。</p>
</div>
<div class="admonition note" id="venv-def">
<p class="first admonition-title">注釈</p>
<p>仮想環境 (<code class="docutils literal"><span class="pre">venv</span></code> とも呼ばれます) は、その中にインストールされた Python インタープリタ、ライブラリ、そしてスクリプトが、他の仮想環境にインストールされたものから分離されている Python 環境です。そして、デフォルトでは、仮想環境は &#8220;システム&#8221; 、すなわち OS の一部としてインストールされた Python 内にインストールされた全てのライブラリからも分離されています。</p>
<p>venv は Python 実行ファイルと、それが venv であることを示す幾つかのファイルを含んだディレクトリツリーです。</p>
<p><code class="docutils literal"><span class="pre">Setuptools</span></code> や <code class="docutils literal"><span class="pre">pip</span></code> のような一般的なインストールツールは、venv で期待通りに動きます。すなわち、venv が有効な場合は何も指定しなくても自動的にその venv に Python パッケージをインストールします。もちろん、これらのインストールツールを最初に venv にインストールする必要があります。そうするには venv を有効化して <code class="docutils literal"><span class="pre">ez_setup.py</span></code> を実行し、続けて <code class="docutils literal"><span class="pre">easy_install</span> <span class="pre">pip</span></code> を実行します。インストールツールを使う代わりに、ソースパッケージをダウンロードして展開した後、 venv を有効化して <code class="docutils literal"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">install</span></code> を実行しても構いません。</p>
<p>venv が有効な場合 (venv の Python インタープリタを実行している時)、 <a class="reference internal" href="sys.html#sys.prefix" title="sys.prefix"><code class="xref py py-attr docutils literal"><span class="pre">sys.prefix</span></code></a> と <a class="reference internal" href="sys.html#sys.exec_prefix" title="sys.exec_prefix"><code class="xref py py-attr docutils literal"><span class="pre">sys.exec_prefix</span></code></a> は venv のベースディレクトリを示します。代わりに <a class="reference internal" href="sys.html#sys.base_prefix" title="sys.base_prefix"><code class="xref py py-attr docutils literal"><span class="pre">sys.base_prefix</span></code></a> と <a class="reference internal" href="sys.html#sys.base_exec_prefix" title="sys.base_exec_prefix"><code class="xref py py-attr docutils literal"><span class="pre">sys.base_exec_prefix</span></code></a> が venv を作った元の Python がインストールされている場所を示します。 venv が無効の時は、 <a class="reference internal" href="sys.html#sys.prefix" title="sys.prefix"><code class="xref py py-attr docutils literal"><span class="pre">sys.prefix</span></code></a> は <a class="reference internal" href="sys.html#sys.base_prefix" title="sys.base_prefix"><code class="xref py py-attr docutils literal"><span class="pre">sys.base_prefix</span></code></a> と、 <a class="reference internal" href="sys.html#sys.exec_prefix" title="sys.exec_prefix"><code class="xref py py-attr docutils literal"><span class="pre">sys.exec_prefix</span></code></a> は <a class="reference internal" href="sys.html#sys.base_exec_prefix" title="sys.base_exec_prefix"><code class="xref py py-attr docutils literal"><span class="pre">sys.base_exec_prefix</span></code></a> と同じになり、両方共 venv ではない Python の場所を示します。</p>
<p>When a venv is active, any options that change the installation path will be
ignored from all distutils configuration files to prevent projects being
inadvertently installed outside of the virtual environment.</p>
<p class="last">When working in a command shell, users can make a venv active by running an
<code class="docutils literal"><span class="pre">activate</span></code> script in the venv&#8217;s executables directory (the precise filename
is shell-dependent), which prepends the venv&#8217;s directory for executables to
the <code class="docutils literal"><span class="pre">PATH</span></code> environment variable for the running shell. There should be no
need in other circumstances to activate a venv &#8211; scripts installed into
venvs have a shebang line which points to the venv&#8217;s Python interpreter. This
means that the script will run with that interpreter regardless of the value
of <code class="docutils literal"><span class="pre">PATH</span></code>. On Windows, shebang line processing is supported if you have the
Python Launcher for Windows installed (this was added to Python in 3.3 - see
<span class="target" id="index-2"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0397"><strong>PEP 397</strong></a> for more details). Thus, double-clicking an installed script in
a Windows Explorer window should run the script with the correct interpreter
without there needing to be any reference to its venv in <code class="docutils literal"><span class="pre">PATH</span></code>.</p>
</div>
</div>
<div class="section" id="api">
<span id="venv-api"></span><h2>28.3.2. API<a class="headerlink" href="#api" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>上述の高水準のメソッドは、サードパーティの仮想環境クリエータが環境の作成を必要に応じてカスタマイズするための機構を提供する簡素な API を利用します。それが <a class="reference internal" href="#venv.EnvBuilder" title="venv.EnvBuilder"><code class="xref py py-class docutils literal"><span class="pre">EnvBuilder</span></code></a> クラスです。</p>
<dl class="class">
<dt id="venv.EnvBuilder">
<em class="property">class </em><code class="descclassname">venv.</code><code class="descname">EnvBuilder</code><span class="sig-paren">(</span><em>system_site_packages=False</em>, <em>clear=False</em>, <em>symlinks=False</em>, <em>upgrade=False</em>, <em>with_pip=False</em><span class="sig-paren">)</span><a class="headerlink" href="#venv.EnvBuilder" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#venv.EnvBuilder" title="venv.EnvBuilder"><code class="xref py py-class docutils literal"><span class="pre">EnvBuilder</span></code></a> クラスを実体化するときに、以下のキーワード引数を受け取ります:</p>
<ul class="simple">
<li><p class="first"><code class="docutils literal"><span class="pre">system_site_packages</span></code> &#8211; 真偽値で、システムの Python の site-packages を仮想環境から利用できるかどうかを示します (デフォルト: <code class="docutils literal"><span class="pre">False</span></code>)。</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">clear</span></code> &#8211; 真偽値で、真の場合環境を作成する前に既存の対象ディレクトリの中身を削除します。</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">symlinks</span></code> &#8211; 真偽値で、Python のバイナリ (と必要な DLL や <code class="docutils literal"><span class="pre">pythonw.exe</span></code> などのバイナリ) をコピーせずにシンボリックの作成を試みるかどうかを示します。デフォルトは Linux や Unix システムでは <code class="docutils literal"><span class="pre">True</span></code> ですが、Windows では <code class="docutils literal"><span class="pre">False</span></code> です。</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">upgrade</span></code> &#8211; 真偽値で、真の場合実行中の Python で既存の環境をアップグレードします。その Python がインプレースでアップグレードされたときに用います。デフォルトは <code class="docutils literal"><span class="pre">False</span></code> です。</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">with_pip</span></code> &#8211; 真偽値で、真の場合仮想環境に pip がインストールされていることを保証します。<code class="docutils literal"><span class="pre">--default-pip</span></code> オプションで  <a class="reference internal" href="ensurepip.html#module-ensurepip" title="ensurepip: Bootstrapping the &quot;pip&quot; installer into an existing Python installation or virtual environment."><code class="xref py py-mod docutils literal"><span class="pre">ensurepip</span></code></a> を使用します。</p>
</li>
</ul>
<div class="versionchanged">
<p><span class="versionmodified">バージョン 3.4 で変更: </span><code class="docutils literal"><span class="pre">with_pip</span></code> 引数が追加されました。</p>
</div>
<p>サードパーティーの仮想環境ツールのクリエータは、<code class="docutils literal"><span class="pre">EnvBuilder</span></code> を継承して使うことができます。</p>
<p>返される env-builder オブジェクトには <code class="docutils literal"><span class="pre">create</span></code> というメソッドがあります:</p>
<dl class="method">
<dt id="venv.EnvBuilder.create">
<code class="descname">create</code><span class="sig-paren">(</span><em>env_dir</em><span class="sig-paren">)</span><a class="headerlink" href="#venv.EnvBuilder.create" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>このメソッドは path (絶対パスあるいは現在のディレクトリからの相対パス) を必要な1つの引数と受け取ります。<code class="docutils literal"><span class="pre">create</span></code> メソッドは指定されたディレクトリに仮想環境を構築するか、例外を送出します。</p>
<p><code class="docutils literal"><span class="pre">EnvBuilder</span></code> クラスの <code class="docutils literal"><span class="pre">create</span></code> メソッドは、サブクラスのカスタマイズに使えるフックを説明します:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env_dir</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a virtualized Python environment in a directory.</span>
<span class="sd">    env_dir is the target directory to create an environment in.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">env_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">env_dir</span><span class="p">)</span>
    <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ensure_directories</span><span class="p">(</span><span class="n">env_dir</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">create_configuration</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setup_python</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setup_scripts</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">post_setup</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</pre></div>
</div>
<p>Each of the methods <a class="reference internal" href="#venv.EnvBuilder.ensure_directories" title="venv.EnvBuilder.ensure_directories"><code class="xref py py-meth docutils literal"><span class="pre">ensure_directories()</span></code></a>,
<a class="reference internal" href="#venv.EnvBuilder.create_configuration" title="venv.EnvBuilder.create_configuration"><code class="xref py py-meth docutils literal"><span class="pre">create_configuration()</span></code></a>, <a class="reference internal" href="#venv.EnvBuilder.setup_python" title="venv.EnvBuilder.setup_python"><code class="xref py py-meth docutils literal"><span class="pre">setup_python()</span></code></a>,
<a class="reference internal" href="#venv.EnvBuilder.setup_scripts" title="venv.EnvBuilder.setup_scripts"><code class="xref py py-meth docutils literal"><span class="pre">setup_scripts()</span></code></a> and <a class="reference internal" href="#venv.EnvBuilder.post_setup" title="venv.EnvBuilder.post_setup"><code class="xref py py-meth docutils literal"><span class="pre">post_setup()</span></code></a> can be overridden.</p>
</dd></dl>

<dl class="method">
<dt id="venv.EnvBuilder.ensure_directories">
<code class="descname">ensure_directories</code><span class="sig-paren">(</span><em>env_dir</em><span class="sig-paren">)</span><a class="headerlink" href="#venv.EnvBuilder.ensure_directories" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Creates the environment directory and all necessary directories, and
returns a context object.  This is just a holder for attributes (such as
paths), for use by the other methods. The directories are allowed to
exist already, as long as either <code class="docutils literal"><span class="pre">clear</span></code> or <code class="docutils literal"><span class="pre">upgrade</span></code> were
specified to allow operating on an existing environment directory.</p>
</dd></dl>

<dl class="method">
<dt id="venv.EnvBuilder.create_configuration">
<code class="descname">create_configuration</code><span class="sig-paren">(</span><em>context</em><span class="sig-paren">)</span><a class="headerlink" href="#venv.EnvBuilder.create_configuration" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>仮想環境に <code class="docutils literal"><span class="pre">pyvenv.cfg</span></code> 設定ファイルを作成します。</p>
</dd></dl>

<dl class="method">
<dt id="venv.EnvBuilder.setup_python">
<code class="descname">setup_python</code><span class="sig-paren">(</span><em>context</em><span class="sig-paren">)</span><a class="headerlink" href="#venv.EnvBuilder.setup_python" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Creates a copy of the Python executable (and, under Windows, DLLs) in
the environment. On a POSIX system, if a specific executable
<code class="docutils literal"><span class="pre">python3.x</span></code> was used, symlinks to <code class="docutils literal"><span class="pre">python</span></code> and <code class="docutils literal"><span class="pre">python3</span></code> will be
created pointing to that executable, unless files with those names
already exist.</p>
</dd></dl>

<dl class="method">
<dt id="venv.EnvBuilder.setup_scripts">
<code class="descname">setup_scripts</code><span class="sig-paren">(</span><em>context</em><span class="sig-paren">)</span><a class="headerlink" href="#venv.EnvBuilder.setup_scripts" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>プラットフォームに対応した有効化スクリプトを仮想環境にインストールします。</p>
</dd></dl>

<dl class="method">
<dt id="venv.EnvBuilder.post_setup">
<code class="descname">post_setup</code><span class="sig-paren">(</span><em>context</em><span class="sig-paren">)</span><a class="headerlink" href="#venv.EnvBuilder.post_setup" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>サードパーティーライブラリがオーバーライドするための空のメソッドです。このメソッドをオーバーライドして、仮想環境構築後にパッケージのプリインストールなどのステップを実装できます。</p>
</dd></dl>

<p>これらに加えて、 <a class="reference internal" href="#venv.EnvBuilder" title="venv.EnvBuilder"><code class="xref py py-class docutils literal"><span class="pre">EnvBuilder</span></code></a> は <a class="reference internal" href="#venv.EnvBuilder.setup_scripts" title="venv.EnvBuilder.setup_scripts"><code class="xref py py-meth docutils literal"><span class="pre">setup_scripts()</span></code></a> やサブクラスの <a class="reference internal" href="#venv.EnvBuilder.post_setup" title="venv.EnvBuilder.post_setup"><code class="xref py py-meth docutils literal"><span class="pre">post_setup()</span></code></a> が仮想環境にスクリプトをインストールするためのユーティリティーメソッドを提供しています。</p>
<dl class="method">
<dt id="venv.EnvBuilder.install_scripts">
<code class="descname">install_scripts</code><span class="sig-paren">(</span><em>context</em>, <em>path</em><span class="sig-paren">)</span><a class="headerlink" href="#venv.EnvBuilder.install_scripts" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>path</em> は &#8220;common&#8221;, &#8220;posix&#8221;, &#8220;nt&#8221; ディレクトリを格納したディレクトリへのパスです。各サブディレクトリには仮想環境の bin ディレクトリにインストールするスクリプトを格納します。 &#8220;common&#8221; の中身と、 <a class="reference internal" href="os.html#os.name" title="os.name"><code class="xref py py-data docutils literal"><span class="pre">os.name</span></code></a> に一致するディレクトリの中身を、以下の置換処理を行いながらコピーします:</p>
<ul class="simple">
<li><p class="first"><code class="docutils literal"><span class="pre">__VENV_DIR__</span></code> は仮想環境ディレクトリの絶対パスに置換されます。</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">__VENV_NAME__</span></code> は仮想環境の名前 (仮想環境ディレクトリのパスの最後の部分) に置換されます。</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">__VENV_PROMPT__</span></code> はプロンプトに置換されます (括弧で囲まれ空白が続く環境名)。</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">__VENV_BIN_NAME__</span></code> は bin ディレクトリ名 (<code class="docutils literal"><span class="pre">bin</span></code> か <code class="docutils literal"><span class="pre">Scripts</span></code>) に置換されます。</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">__VENV_PYTHON__</span></code> は仮想環境の Python 実行ファイルの絶対パスに置換されます。</p>
</li>
</ul>
<p>(既存環境のアップグレード中は) ディレクトリは存在しても構いません。</p>
</dd></dl>

</dd></dl>

<p>モジュールレベルの簡易関数もあります:</p>
<dl class="function">
<dt id="venv.create">
<code class="descclassname">venv.</code><code class="descname">create</code><span class="sig-paren">(</span><em>env_dir</em>, <em>system_site_packages=False</em>, <em>clear=False</em>, <em>symlinks=False</em>, <em>with_pip=False</em><span class="sig-paren">)</span><a class="headerlink" href="#venv.create" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#venv.EnvBuilder" title="venv.EnvBuilder"><code class="xref py py-class docutils literal"><span class="pre">EnvBuilder</span></code></a> を指定されたキーワード引数を使って作成し、その <a class="reference internal" href="#venv.EnvBuilder.create" title="venv.EnvBuilder.create"><code class="xref py py-meth docutils literal"><span class="pre">create()</span></code></a> メソッドに <em>env_dir</em> 引数を渡して実行します。</p>
<div class="versionchanged">
<p><span class="versionmodified">バージョン 3.4 で変更: </span><code class="docutils literal"><span class="pre">with_pip</span></code> 引数が追加されました。</p>
</div>
</dd></dl>

</div>
<div class="section" id="an-example-of-extending-envbuilder">
<h2>28.3.3. <a href="#id1"><span class="problematic" id="id2">`</span></a>EnvBuilder``を拡張する例<a class="headerlink" href="#an-example-of-extending-envbuilder" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>次のスクリプトは、セットアップツールと pip を作成した venv にインストールするサブクラスを実装して、<a class="reference internal" href="#venv.EnvBuilder" title="venv.EnvBuilder"><code class="xref py py-class docutils literal"><span class="pre">EnvBuilder</span></code></a> を拡張する方法を示しています。</p>
<div class="highlight-python"><div class="highlight"><pre>import os
import os.path
from subprocess import Popen, PIPE
import sys
from threading import Thread
from urllib.parse import urlparse
from urllib.request import urlretrieve
import venv

class ExtendedEnvBuilder(venv.EnvBuilder):
    &quot;&quot;&quot;
    This builder installs setuptools and pip so that you can pip or
    easy_install other packages into the created environment.

    :param nodist: If True, setuptools and pip are not installed into the
                   created environment.
    :param nopip: If True, pip is not installed into the created
                  environment.
    :param progress: If setuptools or pip are installed, the progress of the
                     installation can be monitored by passing a progress
                     callable. If specified, it is called with two
                     arguments: a string indicating some progress, and a
                     context indicating where the string is coming from.
                     The context argument can have one of three values:
                     &#39;main&#39;, indicating that it is called from virtualize()
                     itself, and &#39;stdout&#39; and &#39;stderr&#39;, which are obtained
                     by reading lines from the output streams of a subprocess
                     which is used to install the app.

                     If a callable is not specified, default progress
                     information is output to sys.stderr.
    &quot;&quot;&quot;

    def __init__(self, *args, **kwargs):
        self.nodist = kwargs.pop(&#39;nodist&#39;, False)
        self.nopip = kwargs.pop(&#39;nopip&#39;, False)
        self.progress = kwargs.pop(&#39;progress&#39;, None)
        self.verbose = kwargs.pop(&#39;verbose&#39;, False)
        super().__init__(*args, **kwargs)

    def post_setup(self, context):
        &quot;&quot;&quot;
        Set up any packages which need to be pre-installed into the
        environment being created.

        :param context: The information for the environment creation request
                        being processed.
        &quot;&quot;&quot;
        os.environ[&#39;VIRTUAL_ENV&#39;] = context.env_dir
        if not self.nodist:
            self.install_setuptools(context)
        # Can&#39;t install pip without setuptools
        if not self.nopip and not self.nodist:
            self.install_pip(context)

    def reader(self, stream, context):
        &quot;&quot;&quot;
        Read lines from a subprocess&#39; output stream and either pass to a progress
        callable (if specified) or write progress information to sys.stderr.
        &quot;&quot;&quot;
        progress = self.progress
        while True:
            s = stream.readline()
            if not s:
                break
            if progress is not None:
                progress(s, context)
            else:
                if not self.verbose:
                    sys.stderr.write(&#39;.&#39;)
                else:
                    sys.stderr.write(s.decode(&#39;utf-8&#39;))
                sys.stderr.flush()
        stream.close()

    def install_script(self, context, name, url):
        _, _, path, _, _, _ = urlparse(url)
        fn = os.path.split(path)[-1]
        binpath = context.bin_path
        distpath = os.path.join(binpath, fn)
        # Download script into the env&#39;s binaries folder
        urlretrieve(url, distpath)
        progress = self.progress
        if self.verbose:
            term = &#39;\n&#39;
        else:
            term = &#39;&#39;
        if progress is not None:
            progress(&#39;Installing %s ...%s&#39; % (name, term), &#39;main&#39;)
        else:
            sys.stderr.write(&#39;Installing %s ...%s&#39; % (name, term))
            sys.stderr.flush()
        # Install in the env
        args = [context.env_exe, fn]
        p = Popen(args, stdout=PIPE, stderr=PIPE, cwd=binpath)
        t1 = Thread(target=self.reader, args=(p.stdout, &#39;stdout&#39;))
        t1.start()
        t2 = Thread(target=self.reader, args=(p.stderr, &#39;stderr&#39;))
        t2.start()
        p.wait()
        t1.join()
        t2.join()
        if progress is not None:
            progress(&#39;done.&#39;, &#39;main&#39;)
        else:
            sys.stderr.write(&#39;done.\n&#39;)
        # Clean up - no longer needed
        os.unlink(distpath)

    def install_setuptools(self, context):
        &quot;&quot;&quot;
        Install setuptools in the environment.

        :param context: The information for the environment creation request
                        being processed.
        &quot;&quot;&quot;
        url = &#39;https://bitbucket.org/pypa/setuptools/downloads/ez_setup.py&#39;
        self.install_script(context, &#39;setuptools&#39;, url)
        # clear up the setuptools archive which gets downloaded
        pred = lambda o: o.startswith(&#39;setuptools-&#39;) and o.endswith(&#39;.tar.gz&#39;)
        files = filter(pred, os.listdir(context.bin_path))
        for f in files:
            f = os.path.join(context.bin_path, f)
            os.unlink(f)

    def install_pip(self, context):
        &quot;&quot;&quot;
        Install pip in the environment.

        :param context: The information for the environment creation request
                        being processed.
        &quot;&quot;&quot;
        url = &#39;https://raw.github.com/pypa/pip/master/contrib/get-pip.py&#39;
        self.install_script(context, &#39;pip&#39;, url)

def main(args=None):
    compatible = True
    if sys.version_info &lt; (3, 3):
        compatible = False
    elif not hasattr(sys, &#39;base_prefix&#39;):
        compatible = False
    if not compatible:
        raise ValueError(&#39;This script is only for use with &#39;
                         &#39;Python 3.3 or later&#39;)
    else:
        import argparse

        parser = argparse.ArgumentParser(prog=__name__,
                                         description=&#39;Creates virtual Python &#39;
                                                     &#39;environments in one or &#39;
                                                     &#39;more target &#39;
                                                     &#39;directories.&#39;)
        parser.add_argument(&#39;dirs&#39;, metavar=&#39;ENV_DIR&#39;, nargs=&#39;+&#39;,
                            help=&#39;A directory to create the environment in.&#39;)
        parser.add_argument(&#39;--no-setuptools&#39;, default=False,
                            action=&#39;store_true&#39;, dest=&#39;nodist&#39;,
                            help=&quot;Don&#39;t install setuptools or pip in the &quot;
                                 &quot;virtual environment.&quot;)
        parser.add_argument(&#39;--no-pip&#39;, default=False,
                            action=&#39;store_true&#39;, dest=&#39;nopip&#39;,
                            help=&quot;Don&#39;t install pip in the virtual &quot;
                                 &quot;environment.&quot;)
        parser.add_argument(&#39;--system-site-packages&#39;, default=False,
                            action=&#39;store_true&#39;, dest=&#39;system_site&#39;,
                            help=&#39;Give the virtual environment access to the &#39;
                                 &#39;system site-packages dir.&#39;)
        if os.name == &#39;nt&#39;:
            use_symlinks = False
        else:
            use_symlinks = True
        parser.add_argument(&#39;--symlinks&#39;, default=use_symlinks,
                            action=&#39;store_true&#39;, dest=&#39;symlinks&#39;,
                            help=&#39;Try to use symlinks rather than copies, &#39;
                                 &#39;when symlinks are not the default for &#39;
                                 &#39;the platform.&#39;)
        parser.add_argument(&#39;--clear&#39;, default=False, action=&#39;store_true&#39;,
                            dest=&#39;clear&#39;, help=&#39;Delete the contents of the &#39;
                                               &#39;environment directory if it &#39;
                                               &#39;already exists, before &#39;
                                               &#39;environment creation.&#39;)
        parser.add_argument(&#39;--upgrade&#39;, default=False, action=&#39;store_true&#39;,
                            dest=&#39;upgrade&#39;, help=&#39;Upgrade the environment &#39;
                                               &#39;directory to use this version &#39;
                                               &#39;of Python, assuming Python &#39;
                                               &#39;has been upgraded in-place.&#39;)
        parser.add_argument(&#39;--verbose&#39;, default=False, action=&#39;store_true&#39;,
                            dest=&#39;verbose&#39;, help=&#39;Display the output &#39;
                                               &#39;from the scripts which &#39;
                                               &#39;install setuptools and pip.&#39;)
        options = parser.parse_args(args)
        if options.upgrade and options.clear:
            raise ValueError(&#39;you cannot supply --upgrade and --clear together.&#39;)
        builder = ExtendedEnvBuilder(system_site_packages=options.system_site,
                                       clear=options.clear,
                                       symlinks=options.symlinks,
                                       upgrade=options.upgrade,
                                       nodist=options.nodist,
                                       nopip=options.nopip,
                                       verbose=options.verbose)
        for d in options.dirs:
            builder.create(d)

if __name__ == &#39;__main__&#39;:
    rc = 1
    try:
        main()
        rc = 0
    except Exception as e:
        print(&#39;Error: %s&#39; % e, file=sys.stderr)
    sys.exit(rc)
</pre></div>
</div>
<p>このスクリプトは <a class="reference external" href="https://gist.github.com/4673395">オンライン</a> でダウンロードすることも可能です。</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../contents.html">目次</a></h3>
  <ul>
<li><a class="reference internal" href="#">28.3. <code class="docutils literal"><span class="pre">venv</span></code> &#8212; 仮想環境の作成</a><ul>
<li><a class="reference internal" href="#creating-virtual-environments">28.3.1. 仮想環境の作成</a></li>
<li><a class="reference internal" href="#api">28.3.2. API</a></li>
<li><a class="reference internal" href="#an-example-of-extending-envbuilder">28.3.3. `EnvBuilder``を拡張する例</a></li>
</ul>
</li>
</ul>

  <h4>前のトピックへ</h4>
  <p class="topless"><a href="ensurepip.html"
                        title="前の章へ">28.2. <code class="docutils literal"><span class="pre">ensurepip</span></code> &#8212;  <code class="docutils literal"><span class="pre">pip</span></code> インストーラのブートストラップ</a></p>
  <h4>次のトピックへ</h4>
  <p class="topless"><a href="python.html"
                        title="次の章へ">29. Python ランタイムサービス</a></p>
<h3>このページ</h3>
<ul class="this-page-menu">
  <li><a href="../bugs.html">Report a Bug</a></li>
  <li><a href="../_sources/library/venv.txt"
         rel="nofollow">Show Source</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>クイック検索</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="検索" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    モジュール、クラス、または関数名を入力してください
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総合索引"
             >索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="python.html" title="29. Python ランタイムサービス"
             >次へ</a> |</li>
        <li class="right" >
          <a href="ensurepip.html" title="28.2. ensurepip — pip インストーラのブートストラップ"
             >前へ</a> |</li>
        <li><img src="../_static/py.png" alt=""
                 style="vertical-align: middle; margin-top: -1px"/></li>
        <li><a href="https://www.python.org/">Python</a> &raquo;</li>
        <li>
          <span class="version_switcher_placeholder">3.4.3</span>
          <a href="../index.html">Documentation</a> &raquo;
        </li>

          <li class="nav-item nav-item-1"><a href="index.html" >Python 標準ライブラリ</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="distribution.html" >28. ソフトウェア・パッケージと配布</a> &raquo;</li> 
      </ul>
    </div>  
    <div class="footer">
    &copy; <a href="../copyright.html">Copyright</a> 1990-2015, Python Software Foundation.
    <br />
    The Python Software Foundation is a non-profit corporation.
    <a href="https://www.python.org/psf/donations/">Please donate.</a>
    <br />
    Last updated on Dec 28, 2015.
    <a href="../bugs.html">Found a bug</a>?
    <br />
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.1.
    <br />
    <a href="https://github.com/python-doc-ja/python-doc-ja">Pythonドキュメント日本語翻訳プロジェクト</a>
    によって翻訳されました。
    <a href="https://github.com/python-doc-ja/python-doc-ja/issues">誤訳を報告する。</a>
    </div>

  </body>
</html>